## TCP

## 一、TCP的特点及其目的

​	TCP的出现，可以解决数据破坏、丢包、重复以及分片顺序混乱的问题。TCP通过**检验和、序列号、确认应答、重发控制、连接管理以及窗口控制**等机制实现可靠性传输。

## 二、通过序列号与确认应答提高可靠性

​	首先是**确认应答**：发送端的数据发送到接收端后，接收端会返回一个已收到的通知消息，这个消息叫做确认应答(ACK)，只有收到确认应答，发送端才会继续发送下一份数据。这种确认应答的机制保证了可靠性传输，如果有确认应答，说明数据成功到达对端，反之，数据极有可能丢失。当主机A发送数据但未收到确认应答时，有**两种情况**：1. A发送的数据丢失，这种情况毕竟简单，一定时间后A再次发送数据即可。  2. B的确认应答丢失，这种情况下，A端会按照规则再次发送数据，但B端收到相同的数据后会丢弃它并再次发送确认应答。
​	其次是**序列号**：上述提到的确认应答、超时重传、重复控制等机制都是通过序列号实现的，序列号是**按发送顺序给发送数据的每一个自己都标上号码的编号**，接受端**查询接受数据TCP首部中的序列号和数据长度，将下一步应该接受的序列号作为确认应答返送回去**，例如收到了1~1000号的数据，下一次应该从1001号数据开始，那么确认应答就发送1001。
​	重发超时的确定方式：重发超时是指发送端未收到确认应答而重发数据的这段时间间隔，等待超出这段时间的话就重发数据，其计算方式为RTT+偏差再大一点的值。数据重发后若还是收不到应答，这个等待确认应答的时间将以2、4倍指数增长，重发一定次数后就判定网络或对方异常，强制关闭连接。

## 三、连接管理

​	TCP是面向连接的通信传输，面向连接是指在数据通信开始前先做好两端之间的准备工作。连接工作包括建立连接与释放连接。

### 3.1 建立连接：三次握手

​	