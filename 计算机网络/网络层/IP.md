## 一、IP协议基本概念

​	IP协议属于**网络层协议**，网络层协议主要提供终端之间的**点对点通信**。与数据链路层相比较的话，数据链路层提供的是两个设备之间直连的通信，而IP协议负责**在没有直连的两个网络之间进行通信**。IP大致分为三大作用模块：IP寻址、路由以及IP分包与组包。
​	IP协议属于面向无连接型协议，在发包前不建立与目标地址之间的连接：为了简化与提速。

## 二、IP地址

### 2.1 ip地址定义

​	IPv4地址用32位整数表示，通常使用点分十进制的方法描述。IP地址由网络地址和主机地址组成，网络地址在数据链路的每个段配置不同的值，它确保相互连接的每个段的地址不重复，而段内相连的主机必须有相同的网络地址。

### 2.2 ip地址分类

​	IP地址分为四个级别：A~D类，它根据ip地址中网络地址的位数来区分。

1.  A类：前8位是网络地址，**首位必须位0**，网络地址范围为：0.0.0.0~127.0.0.0
2.  B类：前16位是网络地址，以10开头，网络地址范围为：128.0.0.0~191.255.0.0
3.  C类：前24位是网络地址，以100开头，网络地址范围为：192.0.0.0~223.255.255.0
4.  D类：32位全都是网络地址，以1110开头，244.0.0.0~239.255.255.255是D类的网络地址。D类地址没有主机标识，多用于多播。

注意：ip地址的主机位不可全为0或全为1。因为全为0的地址在网络中表示对应的地址不可获知的情况下才使用，而全为1的地址作为广播地址。

### 2.3 广播地址

​	广播地址用于在**同一链路中**相互连接的主机之间发送数据报，将IP地址中的主机号全部设置为1就形成了广播地址。广播分为本地广播和直通广播，前者的数据包只能在本网络下传播，路由器将屏蔽它，而后者可以在不同网络间传播。由于安全问题，大部分情况下路由器不会转发广播。

### 2.4 IP多播

​	多播用于将包发给特定组内的所有主机，不同于广播，多播报文可以穿透路由。多播使用D类地址。

### 2.5 子网掩码

​	直接使用A类或B类地址，对网络资源是一种浪费，因为实际上一个段内没有那么多台计算机，子网掩码可以用来对网络再分段。不同于A、B、C类地址，子网掩码可以使得一个段的网络地址位数不必只有三种选择，而可以是更大的数以达到更小粒度的网络。子网掩码也是32位，对应到ip地址的网络地址部分全为1，主机地址部分全为0，有两种表示方式，主流的一种就是：172.20.100.52/26，表示这个地址前26位是网络地址。

## 三、IP协议相关技术

### 3.1 ARP协议

​	在传输IP数据报时，确定了源IP与目标IP后，会在主机的路由表中查找下一跳的MAC地址。而如果表中没有下一跳的MAC地址，就需要借助ARP协议获取。
​	首先主机广播发送ARP请求包，将想要获取其MAC地址的主机的IP地址填在其中，收到请求包的其它主机会对比包中IP与自身IP是否相符合，如果是则将自己的MAC地址写入ARP响应包并返回给主机。
​	主机收到ARP响应包后，会将这个MAC地址缓存，下次就可以之间获取。	

### 3.2 DNS

​	DNS是用于获取目的IP的方式，例如在浏览器上输入http://www.baidu.com，后面的www.baidu.com就是域名，而要进行通信，就必须获取这个域名所在的服务器的IP地址，而DNS可以帮助浏览器获取IP地址完成解析。
​	在域名中，越往后的的位置表示的层级越高，例如www.baidu.com，com就位于这个域名中最高层级的位置。根域服务器地址储存在所有DNS服务器中，这样任何一个服务器都可以去根域服务器查询<img src="https://cdn.jsdelivr.net/gh/xiaolincoder/ImageHost/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/IP/32.jpg" alt="DNS 树状结构" style="zoom:150%;" /> 

​		DNS域名解析的流程：

1.  首先浏览器在自己的缓存中找，找不到就去操作系统的缓存找，还找不到就去本地host文件找，如果还是找不到，就向本地DNS服务器查询。
2.  本地DNS服务器收到请求后，在缓存中查找，如果查找不到，就像根域服务器查询。
3.  根域服务器收到请求后，发现域名www.baidu.com的域名归com服务器管理，就返回com服务器的地址，让本地的DNS服务器去com服务器查询。
4.  com服务器收到请求后，返回baidu.com服务器的地址，让本地DNS服务器去baidu.com这个服务器查询
5.  baidu.com服务器在它的缓存中找到了相应的IP地址，返回给本地DNS服务器
6.  本地DNS服务器取到IP地址后，返回给浏览器 ![域名解析的工作流程](https://cdn.jsdelivr.net/gh/xiaolincoder/ImageHost/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/IP/33.jpg) 

