## Makefile

​	Makefile是一种用来管理项目中代码文件编译的文件，当项目比较大时，如果一个文件改动，需要重新编译所有文件，耗费的时间比较大，Makefile可以只编译改动了的文件，以及省去每一次都要写gcc命令的麻烦，而是将对应生成可执行文件的gcc命令写在makefile中。

### 一、Makefile的三要素

![1644637537289](D:\DaSan\note\noteImage\1644637537289.png)

​	三要素由目标、依赖、命令组成，其中生成可执行文件为最主要目标，必须写在makefile的第一行。为了达到每次修改只重新编译修改了的文件，必须将终极目标的依赖改成.o文件，然后在下放把所有必须用到的.o文件作为次要目标，并按照图中格式写出其依赖和对应gcc命令。makefile能只重新编译修改了的文件的原理就是，对照每个目标文件的改动时间和依赖文件的生成时间，如果依赖文件的时间比目标文件晚，说明它肯定被改动了，那这个目标就需要重新生成了。

### 二、Makefile中的变量：

 1.    自定义变量：无需声明类型，例如 obj=main.o  sub.o,  target = app，在后面写目标、依赖和命令的时候，就可以用这些变量简化，使用方法为$(变量名)。

 2.    自动变量：

        	1. $<: 规则中的第一个依赖
        	2. $@: 规则中的第一个目标
        	3. $^: 规则中的所有依赖

       自动变量只能在目标块中使用，可用于编写模板，例如:
       %.o : %.c
             gcc  -c  $<  -o   $@    //这个模板可以用与由单个.c文件生成.o文件，而不用针对所有文件一个个写目标块

### 三、Makefile中的函数

​	Makefile中的函数都有返回值，利用函数的返回值，可以简化对目标、依赖和命令的编写，当有很多个文件的时候，不可能手动打出每一个文件名，而是利用函数提取目标路径中的文件然后保存在变量中。使用函数的例子：
​	src = $(wildcard  ./*.c)  #src是一个变量，$代表提取函数返回值中的值，wildcard是一个函数，用于提取路径中特定格式的文件，可以看到，Makefile中函数参数之间跟在函数名后裔，不用加括号。
​	obj = $(patsubst  ./%.o ,  ./%.c , $(src))    #这个函数用于将src中的.c文件替换成.o文件（只是字符串上的替换）

### 四、Makefile编写命令

​	可以在makefile中编写命令，用于清除一些中间文件或输出信息等，例如：

```makefile
.PHONY:clean
clean:
	rm $(obj) $(target) -f
#作用是清除.o文件和target文件，即可执行程序。用法是make clean
#.PHONY的作用是防止文件中有一个叫clean的文件，因为这里的clean是个伪目标，不生成具体文件
```

